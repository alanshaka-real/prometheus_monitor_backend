# 开发进度

## 版本迭代记录

### v1.0.0 — 项目初始化 & 基础骨架

- [x] Spring Boot 3.2.5 项目搭建
- [x] MyBatis-Plus 集成 & 代码生成
- [x] Spring Security + JWT 认证
- [x] 统一响应格式 R\<T\>
- [x] 全局异常处理
- [x] 数据库设计（17 张核心表）
- [x] Knife4j API 文档集成
- [x] CORS 跨域配置

### v1.0.1 — 核心业务模块

- [x] Prometheus 实例管理 CRUD
- [x] Prometheus 连接测试 & 版本检测
- [x] Exporter 管理 CRUD
- [x] PromQL 即时/范围查询代理
- [x] 指标名称 & Label 值查询
- [x] 仪表盘 CRUD
- [x] 告警规则 CRUD

### v1.0.2 — 告警通知 & 集群管理

- [x] 告警历史记录 & 确认
- [x] 静默规则管理
- [x] 通知渠道（钉钉/企微/邮件/Slack/Webhook）
- [x] 通知发送工厂模式重构
- [x] 集群管理 CRUD
- [x] 集群拓扑 & 节点管理
- [x] 集群健康评分计算

### v1.0.3 — 权限与审计

- [x] 用户管理 CRUD（启用/禁用）
- [x] 角色管理（内置 admin/user/viewer）
- [x] 权限树管理
- [x] 角色-权限关联
- [x] @AuditLog 注解 + AOP 审计日志

### v1.0.4 — 查询模板系统

- [x] PromQL 查询模板表设计
- [x] 模板树形分类接口
- [x] 100+ 预置模板数据（Node/MySQL/Redis/Nginx/Blackbox/cAdvisor/Process）
- [x] SQL 迁移脚本
- [x] 查询历史持久化

### v1.0.5 — 仪表盘模板

- [x] 仪表盘模板表设计
- [x] 15+ 预置仪表盘模板
- [x] 模板导入功能
- [x] 面板模板管理

### v1.0.6 — 远程管控

- [x] SSHJ 集成
- [x] Prometheus 远程配置读写
- [x] Prometheus 热加载（`/-/reload`）
- [x] Exporter 远程启停（SSH）
- [x] Exporter 状态检查
- [x] 操作日志记录
- [x] Exporter 批量导入

### v1.0.7 — 分布式部署（基础）

- [x] 目标主机管理 CRUD
- [x] SSH 连接测试
- [x] OS/架构远程检测
- [x] 软件包管理（本地扫描）
- [x] 新增 4 张分布式部署表

### v1.0.8 — 分布式部署（任务系统）

- [x] 部署任务创建 & 执行
- [x] WebSocket 实时日志推送
- [x] WebSocket JWT 认证拦截器
- [x] 任务取消 & 重试
- [x] 任务明细（Per-Machine 状态）

### v1.0.9 — 软件包在线下载

- [x] GitHub Releases API 集成
- [x] 8 种组件在线下载
- [x] 下载进度 WebSocket 推送
- [x] 离线上传支持

### v1.0.10 — 组件配置生成

- [x] ComponentConfigGenerator 组件配置生成器
- [x] CLI 参数生成
- [x] 配置文件生成（blackbox.yml、.my.cnf 等）
- [x] Systemd 服务文件生成
- [x] Prometheus YAML 配置生成 & 校验

### v1.0.11 — 工作空间 & 系统设置

- [x] 工作空间 CRUD
- [x] 仪表盘发布到工作空间
- [x] 全局设置管理
- [x] 系统日志管理 & 导出 & 清理
- [x] 邮件通知 JavaMailSender 实现

### v1.0.12 — 全面审查与优化

#### 安全加固（P1）
- [x] JWT httpOnly Cookie 迁移（AuthController 设置 Set-Cookie，JwtAuthenticationFilter 支持 Cookie + Header 双模式）
- [x] POST /api/auth/logout 端点（清除 httpOnly Cookie）
- [x] WebSocket Token URL 参数清理（WebSocketAuthInterceptor 仅接受消息认证）
- [x] 告警规则评估引擎（AlertEvaluationScheduler @Scheduled 定时评估）
- [x] PromQL 远程验证（AlertServiceImpl.validateOnPrometheus() 调用 Prometheus 即时查询验证语法）
- [x] Alertmanager Webhook 接收（POST /api/prometheus/alert/webhook）

#### 性能优化（P2）
- [x] Spring Cache + Caffeine 缓存（权限树 5min、仪表盘模板树 10min、PromQL 模板树 10min）
- [x] SSH 连接池（SshConnectionPool: commons-pool2 KeyedObjectPool，maxTotal=20, maxPerKey=3）
- [x] 乐观锁（prom_dashboard/alert_rule/instance/exporter 添加 @Version + OptimisticLockerInnerInterceptor）
- [x] 事务隔离（PermissionServiceImpl updateUser/updateRole 使用 REPEATABLE_READ）
- [x] 响应格式统一（PageResult 添加 list/pageNum/pageSize JSON 别名）
- [x] 数据库外键约束（V11 迁移: sys_user_role/sys_role_permission/prom_workspace_dashboard CASCADE）

#### 调度器（P2）
- [x] 静默规则执行（AlertEvaluationScheduler 评估时检查活跃静默规则 + 自动过期）
- [x] 实例健康检查（InstanceHealthScheduler 每 5 分钟 GET /-/healthy）
- [x] 指标元数据同步（MetadataScheduler 每 30 分钟从在线实例同步 /api/v1/metadata）

#### 高级功能（P3）
- [x] 告警收敛/降噪（AlertGroupManager: group_wait 30s / group_interval 5min / repeat_interval 4h）
- [x] Grafana 仪表盘导入/导出（POST /dashboards/import + GET /dashboards/{id}/export?format=grafana）
- [x] 集群拓扑 WebSocket（ClusterTopologyWebSocketHandler /ws/cluster-topology 定时推送）

---

## 规划中的功能

- [ ] 集群节点自动发现（Consul/K8s）
- [ ] 多数据库支持（PostgreSQL）
- [ ] 国际化（接口级 i18n）
